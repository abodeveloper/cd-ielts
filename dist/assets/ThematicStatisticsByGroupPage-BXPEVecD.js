import{j as e,c as S,r as v,_ as de,e as H}from"./index-C2r73vKz.js";import{B as c}from"./badge-BlZvGfOU.js";import{C as O,a as U,b as G,c as Q}from"./card-DvxYgmap.js";import{B as me}from"./BackButton-KVDtITvN.js";import{u as C,E as X}from"./ErrorMessage-Dcw0_FHl.js";import{L as ge}from"./LoadingSpinner-BvOzLLN4.js";import{U as ue,F as he,c as fe,b as xe,_ as _e,h as pe}from"./index-ev-ahMo0.js";import{l as r}from"./lodash-BB9mR6Ly.js";import{a as we}from"./groups-Da_Pi_Gd.js";import{j as je,k as ve,h as ye}from"./test-material-DqdPJ22d.js";import{D as Ne}from"./data-table-ByiohjHV.js";import{I as be}from"./input-Czb5Gnhp.js";import{u as Te}from"./useDebounce-c0882JpI.js";import{b as ke}from"./helper-DHn6dyFE.js";import{B as Se}from"./button-DC1BgMVd.js";import"./index-BdrbzQWw.js";import"./utils-CPYLdFy8.js";import"./createLucideIcon-B8JSSUkB.js";import"./table-CtRoBAPB.js";import"./chevron-right-Cw5t5NbO.js";import"./index-CQPJ8OFz.js";function Ce(o){const i=[{accessorKey:"full_name",header:"Student Name",cell:({row:t})=>e.jsx("div",{children:t.getValue("full_name")})},{accessorKey:"created_at",header:"Test performed",cell:({row:t})=>{const s=String(t.getValue("created_at"));return e.jsxs(e.Fragment,{children:[s.slice(0,10)," ",s.slice(11,19)]})}}],u=[{accessorKey:"total_questions",header:"Total questions",cell:({row:t})=>e.jsx(c,{variant:"outline",children:r.get(t.original.material_info,"total_questions")})},{accessorKey:"incorrect_answers",header:"Incorrect answers",cell:({row:t})=>e.jsx(c,{variant:"destructive",children:r.get(t.original.material_info,"incorrect_answers")})},{accessorKey:"correct_answers",header:"Correct answers",cell:({row:t})=>e.jsx(c,{variant:"success",children:r.get(t.original.material_info,"correct_answers")})},{accessorKey:"score_percentage",header:"Score percentage (%)",cell:({row:t})=>e.jsx(c,{variant:"secondary",children:r.get(t.original.material_info,"score_percentage")})},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,n=r.get(t.original.material_info,"id",null);return e.jsx(S,{to:`/teacher/students/${s}/thematic/reading/${n}/view`,className:"text-blue-500",children:"View"})}}],d=[{accessorKey:"total_questions",header:"Total questions",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"outline",children:r.get(s,"total_questions")})}},{accessorKey:"incorrect_answers",header:"Incorrect answers",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"destructive",children:r.get(s,"incorrect_answers")})}},{accessorKey:"correct_answers",header:"Correct answers",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"success",children:r.get(s,"correct_answers")})}},{accessorKey:"score_percentage",header:"Score percentage (%)",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"secondary",children:r.get(s,"score_percentage")})}},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,n=t.getValue("material_info"),g=r.get(n,"id",null);return e.jsx(e.Fragment,{children:e.jsx(S,{to:`/teacher/students/${s}/thematic/listening/${g}/view`,className:"text-blue-500",children:"View"})})}}],h=[{accessorKey:"writing_task1_score",header:"Writing (T1) score",cell:({row:t})=>{const s=t.original.material_info,n=r.get(s,"writing_task1"),g=r.get(n,"completed",!1);return e.jsx(e.Fragment,{children:g?e.jsx(c,{variant:"secondary",children:r.get(n,"score")}):e.jsx(c,{variant:"destructive",children:"Not completed"})})}},{accessorKey:"writing_task2_score",header:"Writing (T2) score",cell:({row:t})=>{const s=t.original.material_info,n=r.get(s,"writing_task2"),g=r.get(n,"completed",!1);return e.jsx(e.Fragment,{children:g?e.jsx(c,{variant:"secondary",children:r.get(n,"score")}):e.jsx(c,{variant:"destructive",children:"Not completed"})})}},{accessorKey:"score",header:"Total score",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"default",children:r.get(s,"score")})}},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,n=t.getValue("material_info"),g=r.get(n,"id",null);return e.jsx(e.Fragment,{children:e.jsx(S,{to:`/teacher/students/${s}/thematic/writing/${g}/view`,className:"text-blue-500",children:"View"})})}}],x=[{accessorKey:"feedback",header:"Feedback",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(e.Fragment,{children:r.get(s,"feedback")})}},{accessorKey:"score",header:"Score",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"default",children:r.get(s,"score")})}},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,n=t.getValue("material_info"),g=r.get(n,"id",null);return e.jsx(e.Fragment,{children:e.jsx(S,{to:`/teacher/students/${s}/thematic/writing/${g}/view`,className:"text-blue-500",children:"View"})})}}];return o==="reading"?[...i,...u]:o==="speaking"?[...i,...x]:o==="listening"?[...i,...d]:o==="writing"?[...i,...h]:i}const Fe=({testData:o,type:i,material_id:u,group_id:d})=>{const[h,x]=v.useState(!1),t=v.useMemo(()=>({material_id:u,group_id:d}),[u,d]),{data:s,fetchStatus:n,refetch:g}=C({queryKey:["thematic-full-results",t],queryFn:()=>je(i,u,d),enabled:!1}),N=async()=>{x(!0);try{const p=await de(()=>import("./index-CNmUh81P.js"),[]),{Document:F,Packer:P,Paragraph:f,Table:K,TableCell:w,TableRow:b,TextRun:j,WidthType:R,AlignmentType:L,PageOrientation:Z}=p,A=(await g()).data?.results||[];if(A.length===0){console.error("No data fetched from API");return}const M=A[0]?.group_name||"Group Result",J=["No","Student Name","Test Performed"];let T=[];i==="reading"||i==="listening"?T=["Total Questions","Correct Answers","Incorrect Answers","Score Percentage (%)"]:i==="writing"?T=["Writing (T1) Score","Writing (T2) Score","Total Score"]:i==="speaking"&&(T=["Feedback","Score"]);const D=[...J,...T],Y=A.map((a,m)=>{const l=a.material_info,I={no:m+1,name:a.full_name,created_at:`${a.created_at.slice(0,10)} ${a.created_at.slice(11,19)}`};let k={};return i==="reading"||i==="listening"?k={total_questions:l.total_questions?.toString()||"-",correct_answers:l.correct_answers?.toString()||"-",incorrect_answers:l.incorrect_answers?.toString()||"-",score_percentage:l.score_percentage?.toString()||"-"}:i==="writing"?k={writing_task1_score:l.writing_task1?.completed&&l.writing_task1?.score?l.writing_task1.score.toString():"Not completed",writing_task2_score:l.writing_task2?.completed&&l.writing_task2?.score?l.writing_task2.score.toString():"Not completed",total_score:l.score?.toString()||"-"}:i==="speaking"&&(k={feedback:l.feedback||"-",score:l.score?.toString()||"-"}),{...I,...k}}),ee=D.length,q=9026,B=[.5,1.8,...Array(ee-2).fill(1)],te=B.reduce((a,m)=>a+m,0),se=Math.floor(q/te),E=B.map(a=>Math.floor(se*a)),re=E.reduce((a,m)=>a+m,0),V=q-re;V>0&&(E[1]+=V);const $=a=>E[a],ae=new b({children:D.map((a,m)=>new w({children:[new f({children:[new j({text:a,bold:!0})],alignment:L.CENTER})],shading:{fill:"D3D3D3"},width:{size:$(m),type:R.DXA}}))}),ie=Y.map(a=>{const m=[a.no,a.name,a.created_at];return i==="reading"||i==="listening"?m.push(a.total_questions,a.correct_answers,a.incorrect_answers,a.score_percentage):i==="writing"?m.push(a.writing_task1_score,a.writing_task2_score,a.total_score):i==="speaking"&&m.push(a.feedback,a.score),new b({children:m.map((l,I)=>new w({children:[new f({children:[new j({text:String(l)})],alignment:L.LEFT})],width:{size:$(I),type:R.DXA}}))})}),ne=new K({rows:[ae,...ie],width:{size:q,type:R.DXA},columnWidths:D.map((a,m)=>$(m))}),_=[];o&&(_.push(new f({children:[new j({text:`Test Title: ${o.title}`,size:20})]})),_.push(new f({children:[new j({text:`Test Type: ${o.test_type}`,size:20})]}))),_.push(new f({children:[new j({text:`Group: ${M}`,size:24,bold:!0})]})),_.push(new f({text:""})),_.push(ne);const W=new Date().toLocaleString("en-US",{timeZone:"Asia/Tashkent"});_.push(new f({text:""})),_.push(new f({children:[new j({text:`Generated on: ${W}`,size:20})]}));const ce=new F({sections:[{properties:{page:{size:{orientation:Z.PORTRAIT,width:11906,height:16838},margin:{top:1440,right:1440,bottom:1440,left:1440}}},children:_}]}),oe=await P.toBlob(ce),z=window.URL.createObjectURL(oe),y=document.createElement("a");y.href=z;const le=W.replace(/[/:]/g,"-").replace(/,/g,"");y.download=`${M} - Thematic ${i} Results - ${le}.docx`,document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(z)}catch(p){console.error("Error generating Word document:",p)}finally{x(!1)}};return e.jsxs(Se,{onClick:N,disabled:h,children:[h?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(he,{className:"w-5 h-5"})," ","Download"]})},Pe=({type:o,material:i})=>{const{material_id:u,group_id:d}=H(),[h,x]=v.useState(1),[t,s]=v.useState(""),n=Te(t),g=v.useMemo(()=>({material_id:u,group_id:d}),[u,d]),N=ke(g),{data:p,isLoading:F,isError:P}=C({queryKey:["thematic-reading-results",h,n,N],queryFn:()=>ve(o,h,n,"",N)}),f=Ce(o),K=r.get(p,"results",[]),w={totalCount:r.get(p,"count",0),totalPages:r.get(p,"total_pages",1),currentPage:h};return v.useEffect(()=>{x(1)},[n]),P?e.jsx(X,{title:"Failed to Load page",message:"An error occurred while loading the page. Please try again later."}):e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xl font-semibold",children:"Results"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(be,{placeholder:"Search ...",value:t,onChange:b=>s(b.target.value),className:"max-w-sm w-64"}),e.jsx(Fe,{testData:i,group_id:d,material_id:u,type:o})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(Ne,{data:K,columns:f,pagination:!0,totalCount:w.totalCount,totalPages:w.totalPages,currentPage:w.currentPage,onPageChange:x,isLoading:F})})]})})},Ye=()=>{const{group_id:o,material_id:i,skill:u}=H(),{data:d,isLoading:h,isError:x}=C({queryKey:["groups",o],queryFn:()=>we(o)}),{data:t,isLoading:s,isError:n}=C({queryKey:["test-material-thematic",i],queryFn:()=>ye(u,i)});return h||s?e.jsx(ge,{}):x||n?e.jsx(X,{title:"Failed to Load page",message:"An error occurred while loading the page. Please try again later."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xl font-semibold",children:r.get(d,"name")}),e.jsx("div",{className:"flex gap-2",children:e.jsx(me,{to:`/teacher/tests/thematic/statistics/${i}`,label:"Back to thematic groups"})})]}),e.jsxs(O,{className:"w-full",children:[e.jsx(U,{className:"flex flex-row items-center gap-4",children:e.jsx(G,{children:d?.name})}),e.jsxs(Q,{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Number of students"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:d?.students_count})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Status:"}),d?.is_active===!0?e.jsx(c,{variant:"success",children:"Active"}):e.jsx(c,{variant:"destructive",children:"Inactive"})]})]})]}),e.jsxs(O,{className:"w-full",children:[e.jsx(U,{className:"flex flex-row items-center gap-4",children:e.jsxs(G,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{children:r.get(t,"test_info.type")==="reading"?e.jsx(fe,{className:"h-6 w-6"}):r.get(t,"test_info.type")==="listening"?e.jsx(xe,{className:"h-6 w-6"}):r.get(t,"test_info.type")==="writing"?e.jsx(_e,{className:"h-6 w-6"}):e.jsx(pe,{className:"h-6 w-6"})}),e.jsx("div",{children:r.get(t,"test_info.test_title")})]})}),e.jsxs(Q,{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Section title:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.get(t,"material_info.title")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Material title:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.get(t,"title")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Test type:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(c,{variant:"default",children:r.get(t,"test_type","N/A")})})]})]})]}),e.jsx(Pe,{type:r.get(t,"test_info.type"),material:t})]})};export{Ye as default};
