import{r as d,j as e,e as U,u as J}from"./index-D-09amOr.js";import{B as c}from"./badge-Dffs_Ov9.js";import{C as f,a as b,b as X,c as N,d as D}from"./card-CMmmcuPU.js";import{T as E,a as A,b as v,c as r,d as R,e as n}from"./table-DhKSltc-.js";import{B as Z}from"./BackButton-DjUFhrAc.js";import{u as F,E as ee}from"./ErrorMessage-KlD2LGXF.js";import{L as se}from"./LoadingSpinner-Clj1yvjA.js";import{B as L}from"./button-B_vktCce.js";import{S as I}from"./slider-yHASojwS.js";import{D as te,a as ae,b as ie,d as le,e as B,c as O}from"./dropdown-menu-BPEDCNt8.js";import{o as re,G as ne,q as ce,s as de,E as oe,F as xe,c as me,e as V,g as z,b as he,_ as je,h as ue,V as ge,I as pe}from"./index-B45xvXlE.js";import{c as fe}from"./utils-CPYLdFy8.js";import{S as q,C as Ne,a as ve,b as be}from"./collapsible-DzGn8uDB.js";import{l as a}from"./lodash-DGrrF_8h.js";import{h as we}from"./student-Dh4k93lQ.js";import{g as ye}from"./listening-BV0Qog6m.js";import"./index-BdrbzQWw.js";import"./createLucideIcon-2YKpknUA.js";import"./index-DpIpbw6x.js";import"./index-DkQ6Q-DV.js";import"./index-BL8RZMKu.js";import"./index-9Kk-ct4S.js";import"./index-CUifij4W.js";import"./index-fkOmJQjz.js";import"./index-B0930eMD.js";import"./index-mhlRoR13.js";import"./index-ClKh7-XQ.js";import"./index-Dwsy5uKy.js";import"./chevron-right-DnyfEuys.js";const H=({src:g,title:h,onDownload:l,className:p})=>{const o=d.useRef(null),[s,w]=d.useState(!1),[y,_]=d.useState(0),[t,j]=d.useState(0),[x,k]=d.useState(1),[u,T]=d.useState(!1),[C,Q]=d.useState(1);d.useEffect(()=>{const i=o.current;if(!i)return;const m=()=>_(i.currentTime),S=()=>j(i.duration),P=()=>w(!1);return i.addEventListener("timeupdate",m),i.addEventListener("loadedmetadata",S),i.addEventListener("ended",P),()=>{i.removeEventListener("timeupdate",m),i.removeEventListener("loadedmetadata",S),i.removeEventListener("ended",P)}},[]),d.useEffect(()=>{o.current&&(o.current.volume=u?0:x)},[x,u]),d.useEffect(()=>{o.current&&(o.current.playbackRate=C)},[C]);const Y=()=>{const i=o.current;i&&(s?i.pause():i.play(),w(!s))},$=i=>{const m=o.current;m&&(m.currentTime=i[0])},G=i=>{const m=i[0];k(m),T(m===0)},K=()=>{T(!u)},M=i=>{if(!isFinite(i))return"0:00";const m=Math.floor(i/60),S=Math.floor(i%60);return`${m}:${S.toString().padStart(2,"0")}`},W=()=>{if(l)l();else{const i=document.createElement("a");i.href=g,i.download=h||"audio.mp3",document.body.appendChild(i),i.click(),document.body.removeChild(i)}};return e.jsxs("div",{className:fe("flex items-center gap-3 w-full",p),children:[e.jsx("audio",{ref:o,src:g,preload:"metadata"}),e.jsx(L,{onClick:Y,size:"sm",className:"h-10 w-10 rounded-full p-0 bg-blue-600 hover:bg-blue-700",children:s?e.jsx(re,{className:"h-5 w-5 text-white"}):e.jsx(ne,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"text-sm text-gray-700 min-w-[100px]",children:[M(y)," / ",M(t)]}),e.jsx("div",{className:"flex-1",children:e.jsx(I,{value:[y],max:t||100,step:.1,onValueChange:$,className:"w-full"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{onClick:K,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:u||x===0?e.jsx(ce,{className:"h-5 w-5"}):e.jsx(de,{className:"h-5 w-5"})}),e.jsx(I,{value:[u?0:x],max:1,step:.01,onValueChange:G,className:"w-20"})]}),e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(oe,{className:"h-5 w-5"})})}),e.jsxs(ie,{align:"end",className:"w-40",children:[e.jsx(le,{children:"Playback Speed"}),e.jsx(B,{}),[.5,1,1.5,2].map(i=>e.jsxs(O,{onClick:()=>Q(i),className:C===i?"bg-accent":"",children:[i,"x ",C===i&&"✓"]},i)),e.jsx(B,{}),e.jsxs(O,{onClick:W,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Download"]})]})]})]})},_e=({feedback:g})=>{const[h,l]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsxs(Ne,{open:h,onOpenChange:l,children:[e.jsxs(ve,{className:"flex items-center justify-between w-full p-2 hover:bg-muted/50 rounded-lg transition-colors",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground",children:"Feedback"}),h?e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(be,{className:"mt-2",children:e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg border",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:g})})})]})]})},es=()=>{const{id:g,test_type:h,skill:l,obj_id:p}=U(),o=J(),{data:s,isLoading:w,isError:y}=F({queryKey:["student-result",g,l,h,p],queryFn:()=>we(g,h,l,p)}),{data:_}=F({queryKey:["listening-material",p],queryFn:()=>ye(p||""),enabled:l==="listening"&&!!p});return w?e.jsx(se,{}):y?e.jsx(ee,{title:"Failed to Load page",message:"An error occurred while loading the page. Please try again later."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xl font-semibold",children:a.get(s,"student.full_name")}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Z,{label:"Back"})})]}),e.jsxs(f,{className:"w-full",children:[e.jsx(b,{className:"flex flex-row items-center gap-4",children:e.jsx(X,{children:a.get(s,"student.full_name")})}),e.jsxs(N,{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Group:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(c,{onClick:()=>o("/teacher/groups/1"),className:"cursor-pointer",variant:"default",children:a.get(s,"student.group.name")})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Phone number:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.get(s,"student.phone")})]})]})]}),l=="reading"&&e.jsxs(f,{className:"w-full shadow-lg",children:[e.jsxs(b,{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"w-12 h-12"}),e.jsx("h1",{className:"text-center text-lg font-extrabold tracking-tight text-balance",children:"IELTS Academic Reading - Results"})]}),e.jsxs(N,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Test title:"}),e.jsx("div",{children:a.get(s,"test_title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Material title:"}),e.jsx("div",{children:a.get(s,"material_title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Test type:"}),e.jsx("div",{children:a.get(s,"test_type")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Total Questions:"}),e.jsx("div",{children:a.get(s,"statistics.total_questions")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Correct answers:"}),e.jsx("div",{className:"text-green-500",children:a.get(s,"statistics.correct_answers")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Incorrect answers:"}),e.jsx("div",{className:"text-destructive",children:a.get(s,"statistics.incorrect_answers")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Percentage correct:"}),e.jsxs("div",{children:[a.get(s,"statistics.score_percentage")," %"]})]}),h==="mock"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Overal:"}),e.jsx(c,{variant:"default",children:a.get(s,"statistics.overall")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"Answer Review"}),e.jsx("div",{className:"",children:e.jsxs(E,{className:"w-full",children:[e.jsx(A,{children:e.jsxs(v,{children:[e.jsx(r,{children:"Question"}),e.jsx(r,{children:"Your Answer"}),e.jsx(r,{children:"True Answer"}),e.jsx(r,{children:"Status"})]})}),e.jsx(R,{children:a.get(s,"answers",[]).map(t=>e.jsxs(v,{children:[e.jsx(n,{children:t.question_number}),e.jsx(n,{children:t.answer||e.jsx(c,{className:"bg-orange-500",children:"Not answered"})}),e.jsx(n,{children:t.correct_answer}),e.jsx(n,{children:t.is_true?e.jsx(V,{className:"text-green-500"}):e.jsx(z,{className:"text-destructive"})})]},t.id))})]})})]})]}),e.jsx(D,{children:e.jsx("div",{className:"flex items-center justify-between w-full"})})]}),l=="listening"&&e.jsxs(f,{className:"w-full shadow-lg",children:[e.jsxs(b,{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"w-12 h-12"}),e.jsx("h1",{className:"text-center text-lg font-extrabold tracking-tight text-balance",children:"IELTS Academic Listening - Results"})]}),e.jsxs(N,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Test title:"}),e.jsx("div",{children:a.get(s,"test_title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Material title:"}),e.jsx("div",{children:a.get(s,"material_title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Test type:"}),e.jsx("div",{children:a.get(s,"test_type")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Total Questions:"}),e.jsx("div",{children:a.get(s,"statistics.total_questions")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Correct answers:"}),e.jsx("div",{className:"text-green-500",children:a.get(s,"statistics.correct_answers")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Incorrect answers:"}),e.jsx("div",{className:"text-destructive",children:a.get(s,"statistics.incorrect_answers")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Percentage correct:"}),e.jsxs("div",{children:[a.get(s,"statistics.score_percentage")," %"]})]}),h==="mock"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Overal:"}),e.jsx(c,{variant:"default",children:a.get(s,"statistics.overall")})]})]}),l==="listening"&&_&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"Audio"}),e.jsx("div",{className:"space-y-4",children:a.get(_,"listening_parts",[]).sort((t,j)=>(t.listening_section||0)-(j.listening_section||0)).map((t,j)=>{const x=Array.isArray(t.audio)?t.audio[0]:t.audio;return x?e.jsx("div",{className:"w-full",children:e.jsx(H,{src:x,title:t.title||`Section ${t.listening_section||j+1}`})},t.id||j):null})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"Answer Review"}),e.jsx("div",{className:"",children:e.jsxs(E,{className:"w-full",children:[e.jsx(A,{children:e.jsxs(v,{children:[e.jsx(r,{children:"Question"}),e.jsx(r,{children:"Your Answer"}),e.jsx(r,{children:"True Answer"}),e.jsx(r,{children:"Status"})]})}),e.jsx(R,{children:a.get(s,"answers",[]).map(t=>e.jsxs(v,{children:[e.jsx(n,{children:t.question_number}),e.jsx(n,{children:t.answer||e.jsx(c,{className:"bg-orange-500",children:"Not answered"})}),e.jsx(n,{children:t.correct_answer}),e.jsx(n,{children:t.is_true?e.jsx(V,{className:"text-green-500"}):e.jsx(z,{className:"text-destructive"})})]},t.id))})]})})]})]}),e.jsx(D,{children:e.jsx("div",{className:"flex items-center justify-between w-full"})})]}),l=="writing"&&e.jsxs(f,{className:"w-full shadow-lg",children:[e.jsxs(b,{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"w-12 h-12"}),e.jsx("h1",{className:"text-center text-lg font-extrabold tracking-tight text-balance",children:"IELTS Academic Writing - Results"})]}),e.jsxs(N,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Test title:"}),e.jsx("div",{children:a.get(s,"test_title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Material title:"}),e.jsx("div",{children:a.get(s,"material_title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Test type:"}),e.jsx("div",{children:a.get(s,"test_type")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Overal:"}),e.jsx(c,{variant:"default",children:a.get(s,"statistics.average_score")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"Answer Review"}),e.jsx("div",{className:"",children:e.jsxs(E,{className:"w-full",children:[e.jsx(A,{children:e.jsxs(v,{children:[e.jsx(r,{children:"Task"}),e.jsx(r,{children:"Your Answer"}),e.jsx(r,{children:"Word count"}),e.jsx(r,{children:"Score"}),e.jsx(r,{children:"Feedback"})]})}),e.jsx(R,{children:a.get(s,"answers",[]).map(t=>e.jsxs(v,{children:[e.jsx(n,{children:t.task_number}),e.jsx(n,{children:t.answer||e.jsx(c,{className:"bg-orange-500",children:"Not answered"})}),e.jsx(n,{children:t.word_count}),e.jsx(n,{children:e.jsx(c,{variant:"default",children:t.score})}),e.jsx(n,{children:t.feedback})]},t.id))})]})})]})]})]}),l=="speaking"&&e.jsxs(f,{className:"w-full shadow-lg",children:[e.jsxs(b,{className:"flex flex-col gap-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(ue,{className:"w-10 h-10 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:"IELTS Academic Speaking - Results"})]}),e.jsx(q,{}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:"Test title"}),e.jsx("div",{className:"text-sm font-semibold",children:a.get(s,"test_title")||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:"Material title"}),e.jsx("div",{className:"text-sm font-semibold",children:a.get(s,"material_title")||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:"Score"}),e.jsx(c,{variant:"default",className:"w-fit text-base px-3 py-1",children:a.get(s,"statistics.average_score")||"—"})]})]})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsx("style",{children:`
              .speaking-questions * {
                font-size: 16px !important;
              }
              .speaking-questions p,
              .speaking-questions span,
              .speaking-questions div,
              .speaking-questions strong,
              .speaking-questions ul,
              .speaking-questions li {
                font-size: 16px !important;
              }
            `}),a.get(s,"feedback")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground",children:"Feedback"}),e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg border",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a.get(s,"feedback")})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Answer Review"}),e.jsxs("div",{className:"space-y-6",children:[a.get(s,"answers",[])?.map((t,j)=>e.jsx(f,{className:"border-2",children:e.jsxs(N,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"space-y-4",children:t?.questions?.map((x,k)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(c,{variant:"secondary",className:"text-sm font-bold px-3 py-1",children:["Part ",x?.speaking_part]})}),e.jsx("div",{className:"space-y-1.5 pl-4 border-l-2 border-primary/20",children:x?.question?.map((u,T)=>e.jsx("div",{className:"space-y-0.5",children:e.jsxs("div",{className:"flex gap-1.5 items-start",children:[e.jsxs("span",{className:"font-semibold text-primary min-w-[18px] text-[16px] leading-tight",children:[u?.question_number,"."]}),e.jsx("div",{className:"speaking-questions prose max-w-none text-[16px] leading-relaxed [&_p]:mb-0.5 [&_p]:leading-relaxed",dangerouslySetInnerHTML:{__html:u?.question}})]})},T))}),k<(t?.questions?.length||0)-1&&e.jsx(q,{className:"my-4"})]},k))}),e.jsx(q,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground",children:"Your Answer"}),e.jsx("div",{children:t.record?e.jsx(H,{src:t.record,title:"Your recorded answer"}):e.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed rounded-lg bg-muted/50",children:e.jsx(c,{variant:"outline",className:"bg-orange-50 border-orange-300 text-orange-700",children:"Not answered"})})})]}),t.feedback&&e.jsx(_e,{feedback:t.feedback})]})},t.id||j)),(!a.get(s,"answers",[])||a.get(s,"answers",[]).length===0)&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No answers available"})]})]})]})]})]})};export{es as default};
