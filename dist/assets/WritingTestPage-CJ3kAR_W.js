import{j as e,d as N,a as v,u as I,t as j,r as C,R as A,e as F}from"./index-DCOFZdkl.js";import{u as P,F as R,C as E}from"./useTestLogic-kwhjzcVe.js";import{B as L}from"./button-CJmDKSm7.js";import{C as W,a as q,c as k,d as M}from"./card-BNV1fjx2.js";import{_ as $,R as D}from"./index-C-ywvi3k.js";import{T as O}from"./tabs-DpOspKjP.js";import{u as G,T as H,a as h,P as V,C as B,b as Q}from"./usePreventPageLeave-BJ5XuKU_.js";import{o as y,b as z,s as K,n as T,u as U,a as Y}from"./schemas-DglB_8gz.js";import{l as o}from"./lodash-Cljd8h8O.js";import{u as J,a as X,F as Z}from"./index.esm-BneCDedC.js";import{u as ee,E as b}from"./ErrorMessage-CjXSFoQr.js";import{L as se}from"./LoadingSpinner-BYEw7_CK.js";import"./index-BKv6cBc6.js";import"./index-BdrbzQWw.js";import"./utils-CPYLdFy8.js";import"./index-DfDO-NHl.js";import"./index-DlQqJRZi.js";import"./index-3nd8Io2J.js";import"./index-Cwv8Bpok.js";import"./index-DQ8OiU3I.js";import"./index-D-GPwZwk.js";import"./createLucideIcon-CkTYkncT.js";import"./select-xgC8MaKH.js";import"./index-V52C-bAi.js";import"./index-B79pOnWX.js";import"./index-15QhmWVi.js";import"./form-lVj3uFDP.js";import"./circle-ClzbcmRr.js";import"./table-BUyvxy0T.js";import"./input-Cu_XGc4-.js";import"./index-4LcuJ5Yn.js";function te({onNext:t}){return e.jsx("div",{className:"flex items-center justify-center min-h-screen py-4",children:e.jsxs(W,{className:"w-full max-w-3xl shadow-lg",children:[e.jsxs(q,{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-12 h-12"}),e.jsx("h1",{className:"scroll-m-20 text-center text-lg font-extrabold tracking-tight text-balance",children:"IELTS Academic Writing"})]}),e.jsxs(k,{className:"space-y-8",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," 1 hour"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INSTRUCTIONS TO CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Answer both parts."}),e.jsx("li",{children:"You can change your answers at any time during the test."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INFORMATION FOR CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"There are two parts in this test."}),e.jsx("li",{children:"Part 2 contributes twice as much as Part 1 to the writing score."}),e.jsx("li",{children:"The test clock will show you when there are 10 minutes and 5 minutes remaining."})]})]}),e.jsxs("p",{className:"flex gap-2",children:[e.jsx(D,{})," Read instructions and start only when ready."]})]}),e.jsx(M,{children:e.jsx(L,{className:"w-full",onClick:t,children:"Start test"})})]})})}const ae=async t=>(await N.get(`/api/writing/by-material/${t}/`)).data,re=async(t,i)=>(await N.post(`/api/writing-answers/${t}/`,i)).data,ie=y({answers:z(y({writing:T().optional(),question_number:T().optional(),answer:K().nullable().optional()}).nullable()).optional()}),ne=t=>ee({queryKey:["writings",t],queryFn:()=>ae(t),enabled:!!t}),oe=t=>{const{user:i}=v(),r=I(),n=ne(t),m=o.get(n.data,"material"),d=()=>{if(i?.role===A.TEACHER)r("/");else if(String(o.get(m,"test_type"))?.toLowerCase()=="mock"){const s=o.get(m,"next_test"),a=o.get(m,"next_test_id");r(s==="listening"&&a?`/listenings/${a}`:s==="reading"&&a?`/readings/${a}`:s==="speaking"&&a?`/speakings/${a}`:s==="writing"&&a?`/writings/${a}`:"/")}else r("/")},c=()=>{d()},u=U({mutationFn:s=>re(t,s),onSuccess:()=>{j.success("Successfully submitted!"),c()},onError:s=>{console.error("Error:",s),j.error(o.get(s,"response.data.error",""))}}),p=J({resolver:Y(ie),defaultValues:{answers:[]}}),{fields:f,replace:l}=X({control:p.control,name:"answers"});return C.useEffect(()=>{const s=n.data,a=Array.isArray(s?.writing_parts)?s.writing_parts.flatMap(g=>g?.writing_questions?.map(x=>({writing:g.id,question_number:x.question_number,answer:""}))):[];l(a)},[n.data,l]),{form:p,writingMutation:u,onSubmit:s=>{const a=[...o.get(s,"answers",[])];u.mutate(a)},answersFields:f,query:n,finish:d}},le=()=>{const{id:t}=F(),{form:i,onSubmit:r,query:n,writingMutation:m,finish:d}=oe(t),c=o.get(n,"data.writing_parts",[]),u=o.get(n,"data.answer_time",null),{timeLeft:p,formatTime:f,activeTab:l,setActiveTab:w,currentTabIndex:s,handlePrevious:a,handleNext:g,isTestFinished:x}=P(u,c,i.handleSubmit(r),!0,d);G(!x);const S=c.find(_=>`tab-${_.id}`===l);return n.isLoading?e.jsx(se,{message:"Loading test data..."}):n.isError?e.jsx(b,{title:"Failed to Load Test",message:"An error occurred while loading the test. Please try again later."}):n.data?.writing_parts.length===0?e.jsx(b,{title:"Failed to load test",message:"An error occurred while loading the test questions. Please try again later."}):e.jsx(Z,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-primary-foreground space-y-1",children:[e.jsx(H,{timeLeft:p,formatTime:f,testType:h.WRITING,type:o.get(n,"data.material.test_type","Mock")}),e.jsx(V,{activePart:S,testType:h.WRITING})]}),e.jsxs(O,{value:l,onValueChange:w,className:"flex flex-col flex-grow",children:[e.jsx(B,{data:c,activeTab:l,testType:h.WRITING,form:i,testId:t}),e.jsx(Q,{data:c,testType:h.WRITING,form:i,activeTab:l,setActiveTab:w,currentTabIndex:s,handlePrevious:a,handleNext:g,onSubmit:i.handleSubmit(r),isTestFinished:x,isLoading:m.isPending})]})]})})},De=()=>e.jsx(R,{steps:[e.jsx(E,{}),e.jsx(te,{}),e.jsx(le,{})]});export{De as default};
