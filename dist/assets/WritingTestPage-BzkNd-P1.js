import{j as e,d as N,a as v,u as I,t as j,r as C,R as A,e as F}from"./index-CwtWxuzi.js";import{u as P,a as R,F as E,C as L}from"./useTestLogic-DrwSSi1Q.js";import{B as W}from"./button-D3kpZICD.js";import{C as q,a as k,c as M,d as $}from"./card-D02_R5C_.js";import{_ as D,R as O}from"./index-Baci5kEp.js";import{T as G}from"./tabs-DqS3U9j0.js";import{T as H,a as h,P as V,C as B,b as Q}from"./TestNavigation-SrBgwTSX.js";import{o as y,b as z,s as K,n as T,u as U,a as Y}from"./schemas-Dp_BDo1h.js";import{l as o}from"./lodash-BvngGpUb.js";import{u as J,a as X,F as Z}from"./index.esm-sVnwrcWs.js";import{u as ee,E as b}from"./ErrorMessage-BvvT8gXk.js";import{L as se}from"./LoadingSpinner-C6Xu0xqI.js";import"./index-CTaSObxt.js";import"./index-6ASP5Y_r.js";import"./index-BdrbzQWw.js";import"./utils-CPYLdFy8.js";import"./index-Dfn6srHJ.js";import"./index-BjTfhiqu.js";import"./index-BqxPuVWw.js";import"./index-BTEpwRt_.js";import"./index-CkFf3sOu.js";import"./index-BJ84DOP6.js";import"./createLucideIcon-C_MKdDV1.js";import"./index-DpND36gs.js";import"./index-Ctt8U4zB.js";import"./index-yUAH5ZsI.js";import"./form-CjwliyCv.js";import"./dropdown-menu-yhVQDvy_.js";import"./chevron-right-LhqbuYIe.js";import"./table-BcTrh5Ag.js";import"./input-DgijvZTb.js";import"./select-DHX_5Vmg.js";import"./index-BMQCObg6.js";import"./slider-DJvOlbDo.js";import"./index-M0q7im0-.js";function te({onNext:t}){return e.jsx("div",{className:"flex items-center justify-center min-h-screen py-4",children:e.jsxs(q,{className:"w-full max-w-3xl shadow-lg",children:[e.jsxs(k,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-12 h-12"}),e.jsx("h1",{className:"scroll-m-20 text-center text-lg font-extrabold tracking-tight text-balance",children:"IELTS Academic Writing"})]}),e.jsxs(M,{className:"space-y-8",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," 1 hour"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INSTRUCTIONS TO CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Answer both parts."}),e.jsx("li",{children:"You can change your answers at any time during the test."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INFORMATION FOR CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"There are two parts in this test."}),e.jsx("li",{children:"Part 2 contributes twice as much as Part 1 to the writing score."}),e.jsx("li",{children:"The test clock will show you when there are 10 minutes and 5 minutes remaining."})]})]}),e.jsxs("p",{className:"flex gap-2",children:[e.jsx(O,{})," Read instructions and start only when ready."]})]}),e.jsx($,{children:e.jsx(W,{className:"w-full",onClick:t,children:"Start test"})})]})})}const ae=async t=>(await N.get(`/api/writing/by-material/${t}/`)).data,re=async(t,i)=>(await N.post(`/api/writing-answers/${t}/`,i)).data,ie=y({answers:z(y({writing:T().optional(),question_number:T().optional(),answer:K().nullable().optional()}).nullable()).optional()}),ne=t=>ee({queryKey:["writings",t],queryFn:()=>ae(t),enabled:!!t}),oe=t=>{const{user:i}=v(),r=I(),n=ne(t),m=o.get(n.data,"material"),d=()=>{if(i?.role===A.TEACHER)r("/");else if(String(o.get(m,"test_type"))?.toLowerCase()=="mock"){const s=o.get(m,"next_test"),a=o.get(m,"next_test_id");r(s==="listening"&&a?`/listenings/${a}`:s==="reading"&&a?`/readings/${a}`:s==="speaking"&&a?`/speakings/${a}`:s==="writing"&&a?`/writings/${a}`:"/")}else r("/")},c=()=>{d()},u=U({mutationFn:s=>re(t,s),onSuccess:()=>{j.success("Successfully submitted!"),c()},onError:s=>{console.error("Error:",s),j.error(o.get(s,"response.data.error",""))}}),p=J({resolver:Y(ie),defaultValues:{answers:[]}}),{fields:f,replace:l}=X({control:p.control,name:"answers"});return C.useEffect(()=>{const s=n.data,a=Array.isArray(s?.writing_parts)?s.writing_parts.flatMap(g=>g?.writing_questions?.map(x=>({writing:g.id,question_number:x.question_number,answer:""}))):[];l(a)},[n.data,l]),{form:p,writingMutation:u,onSubmit:s=>{const a=[...o.get(s,"answers",[])];u.mutate(a)},answersFields:f,query:n,finish:d}},le=()=>{const{id:t}=F(),{form:i,onSubmit:r,query:n,writingMutation:m,finish:d}=oe(t),c=o.get(n,"data.writing_parts",[]),u=o.get(n,"data.answer_time",null),{timeLeft:p,formatTime:f,activeTab:l,setActiveTab:w,currentTabIndex:s,handlePrevious:a,handleNext:g,isTestFinished:x}=P(u,c,i.handleSubmit(r),!0,d);R(!x);const S=c.find(_=>`tab-${_.id}`===l);return n.isLoading?e.jsx(se,{message:"Loading test data..."}):n.isError?e.jsx(b,{title:"Failed to Load Test",message:"An error occurred while loading the test. Please try again later."}):n.data?.writing_parts.length===0?e.jsx(b,{title:"Failed to load test",message:"An error occurred while loading the test questions. Please try again later."}):e.jsx(Z,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-primary-foreground space-y-1",children:[e.jsx(H,{timeLeft:p,formatTime:f,testType:h.WRITING,type:o.get(n,"data.material.test_type","Mock")}),e.jsx(V,{activePart:S,testType:h.WRITING})]}),e.jsxs(G,{value:l,onValueChange:w,className:"flex flex-col flex-grow",children:[e.jsx(B,{data:c,activeTab:l,testType:h.WRITING,form:i,testId:t}),e.jsx(Q,{data:c,testType:h.WRITING,form:i,activeTab:l,setActiveTab:w,currentTabIndex:s,handlePrevious:a,handleNext:g,onSubmit:i.handleSubmit(r),isTestFinished:x,isLoading:m.isPending})]})]})})},Ve=()=>e.jsx(E,{steps:[e.jsx(L,{}),e.jsx(te,{}),e.jsx(le,{})]});export{Ve as default};
