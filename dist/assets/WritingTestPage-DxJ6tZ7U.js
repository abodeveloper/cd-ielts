import{j as e,d as N,a as _,u as v,t as j,r as C,R as I,e as A}from"./index-BxWpwr9K.js";import{u as F,F as P,C as R}from"./useTestLogic-IcuwJ-1K.js";import{B as E}from"./button-CNuY1AEb.js";import{C as L,a as W,c as q,d as k}from"./card-Dk_bWVLs.js";import{_ as M,R as D}from"./index-B49kkQR6.js";import{T as O}from"./tabs-C6GgIFvb.js";import{u as $,T as G,a as x,P as H,C as V,b as B}from"./usePreventPageLeave-BgcSb0lh.js";import{o as y,b as Q,s as z,n as T,u as K,a as U}from"./schemas-B82KTCYB.js";import{l as o}from"./lodash-B6TVBKew.js";import{u as Y,a as J,F as X}from"./index.esm-ChS6XLnu.js";import{u as Z,E as b}from"./ErrorMessage-D0ZiHF_2.js";import{L as ee}from"./LoadingSpinner-CWTzwFnx.js";import"./index-l1yS5F1P.js";import"./index-BdrbzQWw.js";import"./utils-CPYLdFy8.js";import"./index-BDN4nLcq.js";import"./index-Wh0fB7su.js";import"./index-G9_EqjY3.js";import"./index-BG6d6_mM.js";import"./index-D1JhMIMx.js";import"./index-B0vI_HCU.js";import"./createLucideIcon-CICipjdr.js";import"./select-BN9ZGS1D.js";import"./index-B5emdeup.js";import"./index-BqYe3S9A.js";import"./index-DQnzmU1N.js";import"./form-DYmBEsQu.js";import"./circle-BZ55Rx38.js";import"./table-Dh5MqKeZ.js";import"./input-C5VEc5qf.js";function se({onNext:t}){return e.jsx("div",{className:"flex items-center justify-center min-h-screen py-4",children:e.jsxs(L,{className:"w-full max-w-3xl shadow-lg",children:[e.jsxs(W,{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-12 h-12"}),e.jsx("h1",{className:"scroll-m-20 text-center text-lg font-extrabold tracking-tight text-balance",children:"IELTS Academic Writing"})]}),e.jsxs(q,{className:"space-y-8",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," 1 hour"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INSTRUCTIONS TO CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Answer both parts."}),e.jsx("li",{children:"You can change your answers at any time during the test."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INFORMATION FOR CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"There are two parts in this test."}),e.jsx("li",{children:"Part 2 contributes twice as much as Part 1 to the writing score."}),e.jsx("li",{children:"The test clock will show you when there are 10 minutes and 5 minutes remaining."})]})]}),e.jsxs("p",{className:"flex gap-2",children:[e.jsx(D,{})," Read instructions and start only when ready."]})]}),e.jsx(k,{children:e.jsx(E,{className:"w-full",onClick:t,children:"Start test"})})]})})}const te=async t=>(await N.get(`/api/writing/by-material/${t}/`)).data,ae=async(t,r)=>(await N.post(`/api/writing-answers/${t}/`,r)).data,re=y({answers:Q(y({writing:T().optional(),question_number:T().optional(),answer:z().nullable().optional()}).nullable()).optional()}),ie=t=>Z({queryKey:["writings",t],queryFn:()=>te(t),enabled:!!t}),ne=t=>{const{user:r}=_(),i=v(),n=ie(t),m=o.get(n.data,"material"),l=()=>{if(r?.role===I.TEACHER)i("/");else if(String(o.get(m,"test_type"))?.toLowerCase()=="mock"){const s=o.get(m,"next_test"),a=o.get(m,"next_test_id");i(s==="listening"&&a?`/listenings/${a}`:s==="speaking"&&a?`/speakings/${a}`:s==="writing"&&a?`/writings/${a}`:"/")}else i("/")},h=()=>{l()},p=K({mutationFn:s=>ae(t,s),onSuccess:()=>{j.success("Successfully submitted!"),h()},onError:s=>{console.error("Error:",s),j.error(o.get(s,"response.data.error",""))}}),g=Y({resolver:U(re),defaultValues:{answers:[]}}),{fields:c,replace:d}=J({control:g.control,name:"answers"});return C.useEffect(()=>{const s=n.data,a=Array.isArray(s?.writing_parts)?s.writing_parts.flatMap(u=>u?.writing_questions?.map(f=>({writing:u.id,question_number:f.question_number,answer:""}))):[];d(a)},[n.data,d]),{form:g,writingMutation:p,onSubmit:s=>{const a=[...o.get(s,"answers",[])];p.mutate(a)},answersFields:c,query:n}},oe=()=>{const{id:t}=A(),{form:r,onSubmit:i,query:n,writingMutation:m}=ne(t),l=o.get(n,"data.writing_parts",[]),h=o.get(n,"data.answer_time",null),{timeLeft:p,formatTime:g,activeTab:c,setActiveTab:d,currentTabIndex:w,handlePrevious:s,handleNext:a,isTestFinished:u}=F(h,l,r.handleSubmit(i));$(!u);const f=l.find(S=>`tab-${S.id}`===c);return n.isLoading?e.jsx(ee,{message:"Loading test data..."}):n.isError?e.jsx(b,{title:"Failed to Load Test",message:"An error occurred while loading the test. Please try again later."}):n.data?.writing_parts.length===0?e.jsx(b,{title:"Failed to load test",message:"An error occurred while loading the test questions. Please try again later."}):e.jsx(X,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(i),className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-primary-foreground space-y-1",children:[e.jsx(G,{timeLeft:p,formatTime:g,testType:x.WRITING,type:o.get(n,"data.material.test_type","Mock")}),e.jsx(H,{activePart:f,testType:x.WRITING})]}),e.jsxs(O,{value:c,onValueChange:d,className:"flex flex-col flex-grow",children:[e.jsx(V,{data:l,activeTab:c,testType:x.WRITING,form:r}),e.jsx(B,{data:l,testType:x.WRITING,form:r,activeTab:c,setActiveTab:d,currentTabIndex:w,handlePrevious:s,handleNext:a,onSubmit:r.handleSubmit(i),isTestFinished:u,isLoading:m.isPending})]})]})})},Me=()=>e.jsx(P,{steps:[e.jsx(R,{}),e.jsx(se,{}),e.jsx(oe,{})]});export{Me as default};
