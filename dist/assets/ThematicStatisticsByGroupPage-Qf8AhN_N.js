import{j as e,c as k,r as w,e as $}from"./index-BxWpwr9K.js";import{B as c}from"./badge-C8u5UXDS.js";import{C as K,a as C,b as P,c as q}from"./card-Dk_bWVLs.js";import{B}from"./BackButton-CNGWE1VY.js";import{u as T,E as I}from"./ErrorMessage-D0ZiHF_2.js";import{L as V}from"./LoadingSpinner-CWTzwFnx.js";import{U as R,F as M,c as G,b as z,_ as W,h as Q}from"./index-B49kkQR6.js";import{l as r}from"./lodash-B6TVBKew.js";import{a as Y}from"./groups-Cdn9rGMG.js";import{j as H,k as U,h as O}from"./test-material-BiaYiRi6.js";import{D as Z}from"./data-table-Bs6xurp0.js";import{I as J}from"./input-C5VEc5qf.js";import{u as X}from"./useDebounce-4Qb4dWtM.js";import{b as ee}from"./helper-DHn6dyFE.js";import{B as te}from"./button-CNuY1AEb.js";import{E as se,a as re}from"./jspdf.plugin.autotable-CSyMJutM.js";import"./index-BdrbzQWw.js";import"./utils-CPYLdFy8.js";import"./createLucideIcon-CICipjdr.js";import"./table-Dh5MqKeZ.js";import"./chevron-right-BHV812I6.js";import"./index-l1yS5F1P.js";function ae(o){const a=[{accessorKey:"full_name",header:"Student Name",cell:({row:t})=>e.jsx("div",{children:t.getValue("full_name")})},{accessorKey:"created_at",header:"Test performed",cell:({row:t})=>{const s=String(t.getValue("created_at"));return e.jsxs(e.Fragment,{children:[s.slice(0,10)," ",s.slice(11,19)]})}}],u=[{accessorKey:"total_questions",header:"Total questions",cell:({row:t})=>e.jsx(c,{variant:"outline",children:r.get(t.original.material_info,"total_questions")})},{accessorKey:"incorrect_answers",header:"Incorrect answers",cell:({row:t})=>e.jsx(c,{variant:"destructive",children:r.get(t.original.material_info,"incorrect_answers")})},{accessorKey:"correct_answers",header:"Correct answers",cell:({row:t})=>e.jsx(c,{variant:"success",children:r.get(t.original.material_info,"correct_answers")})},{accessorKey:"score_percentage",header:"Score percentage (%)",cell:({row:t})=>e.jsx(c,{variant:"secondary",children:r.get(t.original.material_info,"score_percentage")})},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,i=r.get(t.original.material_info,"id",null);return e.jsx(k,{to:`/teacher/students/${s}/thematic/reading/${i}/view`,className:"text-blue-500",children:"View"})}}],l=[{accessorKey:"total_questions",header:"Total questions",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"outline",children:r.get(s,"total_questions")})}},{accessorKey:"incorrect_answers",header:"Incorrect answers",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"destructive",children:r.get(s,"incorrect_answers")})}},{accessorKey:"correct_answers",header:"Correct answers",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"success",children:r.get(s,"correct_answers")})}},{accessorKey:"score_percentage",header:"Score percentage (%)",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"secondary",children:r.get(s,"score_percentage")})}},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,i=t.getValue("material_info"),d=r.get(i,"id",null);return e.jsx(e.Fragment,{children:e.jsx(k,{to:`/teacher/students/${s}/thematic/listening/${d}/view`,className:"text-blue-500",children:"View"})})}}],f=[{accessorKey:"writing_task1_score",header:"Writing (T1) score",cell:({row:t})=>{const s=t.original.material_info,i=r.get(s,"writing_task1"),d=r.get(i,"completed",!1);return e.jsx(e.Fragment,{children:d?e.jsx(c,{variant:"secondary",children:r.get(i,"score")}):e.jsx(c,{variant:"destructive",children:"Not completed"})})}},{accessorKey:"writing_task2_score",header:"Writing (T2) score",cell:({row:t})=>{const s=t.original.material_info,i=r.get(s,"writing_task2"),d=r.get(i,"completed",!1);return e.jsx(e.Fragment,{children:d?e.jsx(c,{variant:"secondary",children:r.get(i,"score")}):e.jsx(c,{variant:"destructive",children:"Not completed"})})}},{accessorKey:"score",header:"Total score",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"default",children:r.get(s,"score")})}},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,i=t.getValue("material_info"),d=r.get(i,"id",null);return e.jsx(e.Fragment,{children:e.jsx(k,{to:`/teacher/students/${s}/thematic/writing/${d}/view`,className:"text-blue-500",children:"View"})})}}],h=[{accessorKey:"feedback",header:"Feedback",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(e.Fragment,{children:r.get(s,"feedback")})}},{accessorKey:"score",header:"Score",cell:({row:t})=>{const s=t.original.material_info;return e.jsx(c,{variant:"default",children:r.get(s,"score")})}},{accessorKey:"material_info",header:"Answer review",cell:({row:t})=>{const s=t.original.student_id,i=t.getValue("material_info"),d=r.get(i,"id",null);return e.jsx(e.Fragment,{children:e.jsx(k,{to:`/teacher/students/${s}/thematic/writing/${d}/view`,className:"text-blue-500",children:"View"})})}}];return o==="reading"?[...a,...u]:o==="speaking"?[...a,...h]:o==="listening"?[...a,...l]:o==="writing"?[...a,...f]:a}const ie=({testData:o,type:a,material_id:u,group_id:l})=>{const[f,h]=w.useState(!1),t=w.useMemo(()=>({material_id:u,group_id:l}),[u,l]),{data:s,fetchStatus:i,refetch:d}=T({queryKey:["thematic-full-results",t],queryFn:()=>H(a,u,l),enabled:!1}),N=async()=>{h(!0);try{const v=(await d()).data?.results||[];if(v.length===0){console.error("No data fetched from API");return}const g=new se,S=v[0]?.group_name||"Group Result";let x=10;o&&(g.setFontSize(8),g.text(`Test Title: ${o.title}`,10,x),x+=5,g.text(`Test Type: ${o.test_type}`,10,x),x+=10),g.setFontSize(12),g.text(`Group: ${S}`,10,x),x+=10;const y=["No","Student Name","Test Performed"];let p=[];a==="reading"||a==="listening"?p=["Total Questions","Correct Answers","Incorrect Answers","Score Percentage (%)"]:a==="writing"?p=["Writing (T1) Score","Writing (T2) Score","Total Score"]:a==="speaking"&&(p=["Feedback","Score"]);const A=[...y,...p],D=v.map((n,j)=>{const m=n.material_info,L={no:j+1,name:n.full_name,created_at:`${n.created_at.slice(0,10)} ${n.created_at.slice(11,19)}`};let b={};return a==="reading"||a==="listening"?b={total_questions:m.total_questions?.toString()||"-",correct_answers:m.correct_answers?.toString()||"-",incorrect_answers:m.incorrect_answers?.toString()||"-",score_percentage:m.score_percentage?.toString()||"-"}:a==="writing"?b={writing_task1_score:m.writing_task1?.completed&&m.writing_task1?.score?m.writing_task1.score.toString():"Not completed",writing_task2_score:m.writing_task2?.completed&&m.writing_task2?.score?m.writing_task2.score.toString():"Not completed",total_score:m.score?.toString()||"-"}:a==="speaking"&&(b={feedback:m.feedback||"-",score:m.score?.toString()||"-"}),{...L,...b}}).map(n=>{const j=[n.no,n.name,n.created_at];return a==="reading"||a==="listening"?j.push(n.total_questions,n.correct_answers,n.incorrect_answers,n.score_percentage):a==="writing"?j.push(n.writing_task1_score,n.writing_task2_score,n.total_score):a==="speaking"&&j.push(n.feedback,n.score),j});re(g,{head:[A],body:D,startY:x,theme:"grid",styles:{fontSize:8,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[200,200,200],fontSize:8},columnStyles:{1:{cellWidth:35}},margin:{top:10,left:10,right:10}});const E=g.lastAutoTable.finalY+10;g.setFontSize(8);const F=new Date().toLocaleString("en-US",{timeZone:"Asia/Tashkent"});g.text(`Generated on: ${F}`,10,E),g.save(`${S} - Thematic ${a} Results - ${F}`)}catch(_){console.error("Error generating PDF:",_)}finally{h(!1)}};return e.jsxs(te,{onClick:N,disabled:f,children:[f?e.jsx(R,{className:"w-5 h-5 animate-spin"}):e.jsx(M,{className:"w-5 h-5"})," ","Download"]})},ne=({type:o,material:a})=>{const{material_id:u,group_id:l}=$(),[f,h]=w.useState(1),[t,s]=w.useState(""),i=X(t),d=w.useMemo(()=>({material_id:u,group_id:l}),[u,l]),N=ee(d),{data:_,isLoading:v,isError:g}=T({queryKey:["thematic-reading-results",f,i,N],queryFn:()=>U(o,f,i,"",N)}),S=ae(o),x=r.get(_,"results",[]),y={totalCount:r.get(_,"count",0),totalPages:r.get(_,"total_pages",1),currentPage:f};return w.useEffect(()=>{h(1)},[i]),g?e.jsx(I,{title:"Failed to Load page",message:"An error occurred while loading the page. Please try again later."}):e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xl font-semibold",children:"Results"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{placeholder:"Search ...",value:t,onChange:p=>s(p.target.value),className:"max-w-sm w-64"}),e.jsx(ie,{testData:a,group_id:l,material_id:u,type:o})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(Z,{data:x,columns:S,pagination:!0,totalCount:y.totalCount,totalPages:y.totalPages,currentPage:y.currentPage,onPageChange:h,isLoading:v})})]})})},Ce=()=>{const{group_id:o,material_id:a,skill:u}=$(),{data:l,isLoading:f,isError:h}=T({queryKey:["groups",o],queryFn:()=>Y(o)}),{data:t,isLoading:s,isError:i}=T({queryKey:["test-material-thematic",a],queryFn:()=>O(u,a)});return f||s?e.jsx(V,{}):h||i?e.jsx(I,{title:"Failed to Load page",message:"An error occurred while loading the page. Please try again later."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xl font-semibold",children:r.get(l,"name")}),e.jsx("div",{className:"flex gap-2",children:e.jsx(B,{to:`/teacher/tests/thematic/statistics/${a}`,label:"Back to thematic groups"})})]}),e.jsxs(K,{className:"w-full",children:[e.jsx(C,{className:"flex flex-row items-center gap-4",children:e.jsx(P,{children:l?.name})}),e.jsxs(q,{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Number of students"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:l?.students_count})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Status:"}),l?.is_active===!0?e.jsx(c,{variant:"success",children:"Active"}):e.jsx(c,{variant:"destructive",children:"Inactive"})]})]})]}),e.jsxs(K,{className:"w-full",children:[e.jsx(C,{className:"flex flex-row items-center gap-4",children:e.jsxs(P,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{children:r.get(t,"test_info.type")==="reading"?e.jsx(G,{className:"h-6 w-6"}):r.get(t,"test_info.type")==="listening"?e.jsx(z,{className:"h-6 w-6"}):r.get(t,"test_info.type")==="writing"?e.jsx(W,{className:"h-6 w-6"}):e.jsx(Q,{className:"h-6 w-6"})}),e.jsx("div",{children:r.get(t,"test_info.test_title")})]})}),e.jsxs(q,{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Section title:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.get(t,"material_info.title")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Material title:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.get(t,"title")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-sm text-primary font-extrabold",children:"Test type:"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(c,{variant:"default",children:r.get(t,"test_type","N/A")})})]})]})]}),e.jsx(ne,{type:r.get(t,"test_info.type"),material:t})]})};export{Ce as default};
