import{a as V,j as o,c as q,R as G,r as l,h as A,t as Q}from"./index-DDYar315.js";import{B as X}from"./button-DuM14ORo.js";import{C as Z,a as K,c as ee,d as te}from"./card-BLRj5yAg.js";import{C as re,R as ne,_ as se,i as J,M as oe}from"./index-DpK8cseF.js";import{l as z}from"./lodash-BKtGTwVo.js";import{p as le,l as ie}from"./index-C2lZ62Ym.js";function me({onNext:i}){const{user:f}=V();return o.jsx("div",{className:"flex items-center justify-center min-h-screen bg-muted w-full",children:o.jsxs(Z,{className:"w-full max-w-lg shadow-lg",children:[o.jsxs(K,{className:"flex items-center space-x-2",children:[o.jsx(re,{className:"w-12 h-12"}),o.jsx("h1",{className:"scroll-m-20 text-center text-lg font-extrabold tracking-tight text-balance",children:"Confirm your details"})]}),o.jsxs(ee,{className:"space-y-8",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Name:"})," ",z.get(f,"full_name")]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Phone number:"})," ",z.get(f,"phone")]})]}),o.jsxs("div",{className:"flex flex-wrap gap-2 items-center text-center md:flex-row md:items-center md:text-left",children:[o.jsx(ne,{}),o.jsx("span",{children:"If your details are not correct, please"}),o.jsx(q,{to:f?.role===G.TEACHER?"/teacher/profile":"/student/profile",className:"text-blue-600 flex gap-2 items-center",children:"update your profile."})]})]}),o.jsx(te,{children:o.jsx(X,{className:"w-full",onClick:i,children:"My details are correct"})})]})})}function we({steps:i}){const[f,w]=l.useState(0),[S,d]=l.useState({}),b=y=>{f<i.length-1&&(y&&d(g=>({...g,...y})),w(g=>g+1))};l.useEffect(()=>{const g=i[f]?.props?.disableOverflow??!1;return g||(document.body.style.overflow="hidden"),()=>{g||(document.body.style.overflow="auto")}},[f,i]);const x=i[f];return o.jsx("div",{children:A.isValidElement(x)&&A.cloneElement(x,{onNext:b,formData:S})})}const Y=i=>i&&i.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>"),ce=i=>i&&(i.includes("<")?i.replace(/>([^<]*?)</g,(f,w)=>w.trim()?`>${Y(w)}<`:f):Y(i)),ae=({src:i,alt:f,style:w,className:S})=>{const d=l.useRef(null),b=l.useRef(null),x=l.useRef(null),[y,g]=l.useState(!1),[k,C]=l.useState(!1),[E,R]=l.useState(!1),[N,I]=l.useState("black");l.useEffect(()=>{const t=b.current,c=x.current;if(!t||!c)return;const u=t.getContext("2d");if(!u)return;const v=()=>{if(c&&t){const a=c.getBoundingClientRect(),r=window.devicePixelRatio||1,n=u.globalCompositeOperation,h=u.lineWidth,p=u.strokeStyle;t.width=a.width*r,t.height=a.height*r,t.style.width=`${a.width}px`,t.style.height=`${a.height}px`,u.setTransform(1,0,0,1,0,0),u.scale(r,r),u.globalCompositeOperation=n,u.lineWidth=h,u.strokeStyle=p,u.lineCap="round",u.lineJoin="round"}},e=()=>{v()};c.complete?e():c.addEventListener("load",e);const s=new ResizeObserver(()=>{v()});return c&&s.observe(c),()=>{c.removeEventListener("load",e),s.disconnect()}},[i]),l.useEffect(()=>{const t=b.current;if(!t)return;const c=t.getContext("2d");if(c)if(E)c.globalCompositeOperation="destination-out",c.lineWidth=20,c.lineCap="round",c.lineJoin="round";else{c.globalCompositeOperation="source-over";const u={black:"#000000",red:"#ff0000",yellow:"#ffeb3b"};c.strokeStyle=u[N],c.lineWidth=5,c.lineCap="round",c.lineJoin="round"}},[E,N]);const T=t=>{const c=b.current;if(!c)return{x:0,y:0};const u=c.getBoundingClientRect(),v="touches"in t?t.touches[0]?.clientX||0:t.clientX,e="touches"in t?t.touches[0]?.clientY||0:t.clientY;return{x:v-u.left-2,y:e-u.top-4}},_=t=>{const c=window.getSelection();if(c&&c.toString().trim().length>0)return;t.preventDefault(),C(!0),g(!0);const u=b.current,v=u?.getContext("2d");if(!u||!v)return;const{x:e,y:s}=T(t);v.beginPath(),v.moveTo(e,s)},F=t=>{if(!y)return;const c=window.getSelection();if(c&&c.toString().trim().length>0){g(!1);return}t.preventDefault();const u=b.current,v=u?.getContext("2d");if(!u||!v)return;const{x:e,y:s}=T(t);v.lineTo(e,s),v.stroke()},P=t=>{t&&t.preventDefault(),g(!1)},O=()=>{C(!1),g(!1)},D=()=>{C(!0)},$=E?"url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23ff0000%22 stroke-width=%222%22><rect x=%223%22 y=%223%22 width=%2218%22 height=%2218%22 rx=%222%22/><path d=%22M8 8l8 8M16 8l-8 8%22/></svg>') 12 12, auto":"url('data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23000%22 stroke-width=%222%22><path d=%22M12 19l7-7 3 3-7 7-3-3z%22/><path d=%22M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z%22/><path d=%22M2 2l7.586 7.586%22/><path d=%22M11 11l2 2%22/></svg>') 12 6, auto";return l.useEffect(()=>{const t=d.current;if(!t)return;const c=v=>{const e=window.getSelection();e&&e.rangeCount>0&&v.stopPropagation()},u=v=>{const e=window.getSelection();e&&e.toString().trim().length>0&&v.stopPropagation()};return t.addEventListener("scroll",c,{passive:!0}),t.addEventListener("wheel",u,{passive:!0}),()=>{t.removeEventListener("scroll",c),t.removeEventListener("wheel",u)}},[]),o.jsxs("div",{className:"relative inline-block image-drawer-container",children:[o.jsxs("div",{ref:d,className:"relative inline-block group image-drawer-container",style:{cursor:k?$:"default"},onMouseEnter:t=>{t.stopPropagation(),D()},onMouseLeave:t=>{t.stopPropagation(),O()},onClick:t=>{const c=window.getSelection();c&&c.toString().trim().length>0||t.stopPropagation()},onScroll:t=>{t.stopPropagation()},children:[o.jsx("img",{ref:x,src:i,alt:f||"",style:w,className:S,draggable:!1}),o.jsx("canvas",{ref:b,className:"absolute top-0 left-0 pointer-events-auto",style:{cursor:k?$:"default"},onMouseDown:_,onMouseMove:F,onMouseUp:P,onMouseLeave:P,onTouchStart:_,onTouchMove:F,onTouchEnd:P})]}),o.jsxs("div",{className:"absolute top-0 right-0 -translate-y-full mb-2 flex items-center gap-2 bg-white/95 backdrop-blur-sm rounded-lg shadow-lg p-2 border border-gray-200",children:[!E&&o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),I("black")},className:`w-7 h-7 rounded-full border-2 transition-all hover:scale-110 ${N==="black"?"border-gray-900 scale-110 shadow-md ring-2 ring-gray-300":"border-gray-300 hover:border-gray-500"}`,style:{backgroundColor:"#000000"}}),o.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),I("red")},className:`w-7 h-7 rounded-full border-2 transition-all hover:scale-110 ${N==="red"?"border-gray-900 scale-110 shadow-md ring-2 ring-red-200":"border-gray-300 hover:border-gray-500"}`,style:{backgroundColor:"#ff0000"}}),o.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),I("yellow")},className:`w-7 h-7 rounded-full border-2 transition-all hover:scale-110 ${N==="yellow"?"border-gray-900 scale-110 shadow-md ring-2 ring-yellow-200":"border-gray-300 hover:border-gray-500"}`,style:{backgroundColor:"#ffeb3b"}})]}),o.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),R(!E)},className:`p-2 rounded-md shadow-sm transition-all hover:scale-105 ${E?"bg-red-500 text-white hover:bg-red-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:E?o.jsx(se,{className:"w-4 h-4"}):o.jsx(J,{className:"w-4 h-4"})})]})]})},xe=({htmlString:i,className:f="",enabledHighlight:w=!0,storageKey:S})=>{const d=l.useRef(null),[b,x]=l.useState(null),[y,g]=l.useState(null),[k,C]=l.useState(null),E=l.useRef(0),R=l.useRef(null),[N,I]=l.useState(i),T=l.useRef(!1),_=()=>Date.now().toString()+Math.random().toString(36).slice(2),F=e=>{if(!d.current)return[];const s=[],a=document.createTreeWalker(d.current,NodeFilter.SHOW_ELEMENT,{acceptNode(n){if(!(n instanceof HTMLElement))return NodeFilter.FILTER_REJECT;const h=window.getComputedStyle(n);return(h.display==="block"||h.display==="list-item"||h.display==="table"||["P","DIV","LI"].includes(n.tagName))&&e.intersectsNode(n)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}},!1);let r=a.nextNode();for(;r;)s.push(r),r=a.nextNode();return s},P=(e,s)=>{const a=e.extractContents(),r=document.createElement("span");r.className="highlight",r.dataset.highlightId=s,r.appendChild(a),e.insertNode(r),S&&d.current&&setTimeout(()=>{if(d.current)try{localStorage.setItem(`highlights_${S}`,d.current.innerHTML)}catch(n){console.warn("Failed to save highlights:",n)}},0)},O=()=>{if(!w||!b)return;const e=b.cloneRange(),s=_(),a=F(e);a.length===0?P(e,s):a.forEach(r=>{const n=document.createRange();let h=e.startContainer,p=e.startOffset,m=e.endContainer,j=e.endOffset;r.contains(h)||(h=r,p=0),r.contains(m)||(m=r,j=r.childNodes.length);try{n.setStart(h,p),n.setEnd(m,j),n.collapsed||P(n,s)}catch{}}),x(null),g(null),C(null)},D=l.useCallback(()=>{w&&(R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{const e=window.getSelection();if(e&&e.rangeCount>0&&d.current?.contains(e.anchorNode)){const s=e.getRangeAt(0),a=e.toString().trim();if(!s.collapsed&&a.length>0){const r=s.getBoundingClientRect();let n=s.commonAncestorContainer;n.nodeType===Node.TEXT_NODE&&(n=n.parentNode),n&&n.classList&&n.classList.contains("highlight")?(C(n),x(null)):(C(null),x(s));const h=window.innerWidth,p=200,m=50;let j=r.left+window.scrollX+r.width/2;j+p/2>h+window.scrollX?j=h+window.scrollX-p/2-10:j-p/2<window.scrollX&&(j=window.scrollX+p/2+10);let M=r.top+window.scrollY-m-35;M<window.scrollY&&(M=r.bottom+window.scrollY+35),g({x:j,y:M,width:p})}else x(null),C(null),g(null)}else x(null),C(null),g(null)},150))},[w]),L=l.useCallback(()=>{const e=Date.now();e-E.current<300||(E.current=e,D())},[D]),H=l.useCallback(()=>{D()},[D]);l.useEffect(()=>{if(!w)return;document.addEventListener("mouseup",L),document.addEventListener("dblclick",H);const e=a=>{const r=a.target;r.closest("img")||r.closest(".image-drawer-container")||r.tagName==="IMG"||d.current?.contains(r)||(C(null),g(null))},s=a=>{const r=window.getSelection();r&&r.toString().trim().length>0&&a.stopPropagation()};return document.body.addEventListener("click",e),window.addEventListener("scroll",s,{passive:!0}),document.addEventListener("scroll",s,{passive:!0}),()=>{document.removeEventListener("mouseup",L),document.removeEventListener("dblclick",H),document.body.removeEventListener("click",e),window.removeEventListener("scroll",s),document.removeEventListener("scroll",s),R.current&&clearTimeout(R.current)}},[L,H,w]);const $=e=>{e.stopPropagation();const s=e.currentTarget;C(s),x(null);const a=s.getBoundingClientRect(),r=window.innerWidth,n=200,h=50;let p=a.left+window.scrollX+a.width/2;p+n/2>r+window.scrollX?p=r+window.scrollX-n/2-10:p-n/2<window.scrollX&&(p=window.scrollX+n/2+10);let m=a.top+window.scrollY-h-35;m<window.scrollY&&(m=a.bottom+window.scrollY+35),g({x:p,y:m,width:n})},t=()=>{if(w){if(k){const e=k,s=e.parentNode;if(s){for(;e.firstChild;)s.insertBefore(e.firstChild,e);s.removeChild(e)}}else if(b&&!k){const e=b.cloneRange();if(!d.current)return;const s=[],a=document.createTreeWalker(d.current,NodeFilter.SHOW_ELEMENT,{acceptNode(n){return n instanceof HTMLElement&&n.classList.contains("highlight")&&e.intersectsNode(n)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}},!1);let r=a.nextNode();for(;r;)s.push(r),r=a.nextNode();s.forEach(n=>{const h=n.parentNode;if(h){for(;n.firstChild;)h.insertBefore(n.firstChild,n);h.removeChild(n)}})}S&&d.current&&setTimeout(()=>{if(d.current)try{localStorage.setItem(`highlights_${S}`,d.current.innerHTML)}catch(e){console.warn("Failed to save highlights:",e)}},0),x(null),C(null),g(null)}};l.useEffect(()=>{I(i),T.current=!1},[i]),l.useEffect(()=>{if(S&&d.current&&!T.current)try{const e=localStorage.getItem(`highlights_${S}`);e?setTimeout(()=>{if(d.current){const s=document.createElement("div");s.innerHTML=e;const a=s.querySelectorAll(".highlight");a.length>0&&a.forEach(r=>{const n=r.getAttribute("data-highlight-id"),h=r.textContent;if(h&&d.current){const p=document.createTreeWalker(d.current,NodeFilter.SHOW_TEXT,null);let m;for(;m=p.nextNode();){const M=(m.textContent||"").indexOf(h);if(M!==-1&&m.parentElement&&!m.parentElement.classList.contains("highlight"))try{const W=document.createRange();W.setStart(m,M),W.setEnd(m,M+h.length);const B=document.createElement("span");B.className="highlight",B.dataset.highlightId=n||Date.now().toString();const U=W.extractContents();B.appendChild(U),W.insertNode(B);break}catch{}}}})}T.current=!0},150):T.current=!0}catch(e){console.warn("Failed to restore highlights:",e),T.current=!0}},[S,N]);const c=typeof N=="string"&&N.trim().length>0?N:i,u=ce(c),v=le(u,{replace:e=>{if(e.type==="tag"&&e.name==="span"&&e.attribs&&e.attribs.class&&e.attribs.class.includes("highlight"))return l.createElement("span",{...e.attribs,onClick:$,style:{cursor:"pointer"},key:e.attribs["data-highlight-id"]||void 0},e.children&&ie.domToReact(e.children));if(e.type==="tag"&&e.name==="img"&&e.attribs){const{src:s,alt:a,style:r,className:n}=e.attribs;let h={};return r&&r.split(";").forEach(p=>{const[m,j]=p.split(":").map(M=>M.trim());if(m&&j){const M=m.replace(/-([a-z])/g,W=>W[1].toUpperCase());h[M]=j}}),o.jsx(ae,{src:s||"",alt:a||"",style:h,className:n||""},s||Math.random().toString())}}});return o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
        .highlight {
          background-color: #fde68a;
        }
      `}),o.jsx("div",{ref:d,className:`w-full text-sm text-[--foreground] ${f}
          [&_table]:w-full [&_table]:border-collapse
          [&_td]:border [&_td]:border-[--border] [&_td]:p-2
          [&_th]:border [&_th]:border-[--border] [&_th]:p-2
          [&_p]:mb-2 [&_p]:text-[--foreground]
          [&_h3]:text-lg [&_h3]:font-semibold [&_h3]:mb-2 [&_h3]:text-[--foreground]
          [&_strong]:font-bold [&_em]:italic select-text`,style:{userSelect:"text"},children:v}),w&&y&&(b||k)&&o.jsxs("div",{className:"absolute z-50 flex gap-2 rounded-lg border bg-muted p-2 shadow-lg -translate-x-1/2",style:{left:y.x,top:y.y},children:[!k&&o.jsxs(X,{size:"sm",onClick:O,children:[o.jsx(oe,{className:"mr-1 h-4 w-4"})," Highlight"]}),o.jsxs(X,{size:"sm",variant:"destructive",onClick:t,disabled:!k&&!b,children:[o.jsx(J,{className:"mr-1 h-4 w-4"})," Clear"]})]})]})},ve=(i,f,w,S=!0,d)=>{const[b,x]=l.useState(i),[y,g]=l.useState(!1),[k,C]=l.useState(""),E=l.useRef(null),R=l.useRef(null),N=l.useRef(!1),I=l.useRef(!1),T=()=>{R.current&&(clearInterval(R.current),R.current=null)};l.useEffect(()=>{i!==null?(E.current=Date.now()+i*1e3,x(i),N.current=!1):(E.current=null,x(null))},[i]),l.useEffect(()=>{if(i===null||y||!S&&!I.current)return;!I.current&&i!==null&&(E.current=Date.now()+i*1e3,x(i)),I.current=!0;const L=()=>{if(E.current===null)return;const H=Math.max(0,Math.round((E.current-Date.now())/1e3));x(H),H<=0&&!y&&!N.current&&(T(),N.current=!0,g(!0),Q.error("The time limit has expired."),w(),d&&setTimeout(()=>{d()},100))};return L(),R.current=setInterval(L,1e3),()=>{(y||!I.current)&&T()}},[i,y,w,S]),l.useEffect(()=>{f.length>0&&!k&&C(`tab-${f[0].id}`)},[f,k]);const _=f.findIndex(L=>`tab-${L.id}`===k);return{timeLeft:b??0,formatTime:L=>`${Math.floor(L/60).toString().padStart(2,"0")}:${(L%60).toString().padStart(2,"0")}`,activeTab:k,setActiveTab:C,currentTabIndex:_,handlePrevious:()=>_>0&&C(`tab-${f[_-1].id}`),handleNext:()=>_<f.length-1&&C(`tab-${f[_+1].id}`),isTestFinished:y,finishTest:()=>{i!==null&&!y&&(T(),w(),g(!0))}}};export{me as C,we as F,xe as H,ae as I,ve as u};
