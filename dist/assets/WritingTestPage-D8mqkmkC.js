import{j as e,d as N,a as _,u as v,t as j,r as I,R as C,e as A}from"./index-x8u20K9c.js";import{u as F,a as P,F as R,C as E}from"./useTestLogic-DIhDJA0i.js";import{B as L}from"./button-CEk6aIhe.js";import{C as W,a as q,c as k,d as M}from"./card-pj2_oIhs.js";import{_ as $,R as D}from"./index-xH9p-mai.js";import{T as O}from"./tabs-ComX90W5.js";import{T as G,a as x,P as H,C as V,b as B}from"./TestNavigation-DYLg1P3g.js";import{o as y,b as Q,s as z,n as T,u as K,a as U}from"./schemas-CU4oz3Xv.js";import{l as o}from"./lodash-BfwN313r.js";import{u as Y,a as J,F as X}from"./index.esm-RGAbAXOb.js";import{u as Z,E as b}from"./ErrorMessage-DASnKxHi.js";import{L as ee}from"./LoadingSpinner-CCmmZw_H.js";import"./index-cvnCV2lx.js";import"./index-NCJt2kZ7.js";import"./index-BdrbzQWw.js";import"./utils-CPYLdFy8.js";import"./index-DGhdctO5.js";import"./index-DM6KgMx9.js";import"./index-DQ7s4Qvh.js";import"./index-DtRr-aci.js";import"./index-Cn6PYWlw.js";import"./index-vNbpX9rJ.js";import"./createLucideIcon-OAtobG9R.js";import"./index-CH-WY6Gi.js";import"./index-C5fZkf1s.js";import"./index-DGpIz9EJ.js";import"./form-BCNEXsXm.js";import"./dropdown-menu-uq8_Kjkt.js";import"./chevron-right-CUIRr8L6.js";import"./table-BnVQCl16.js";import"./input-136_Gzk7.js";import"./select-D95fSLWL.js";import"./index-DZHX_3AM.js";import"./slider-BqH77hFY.js";import"./index-0PA4DpKW.js";function te({onNext:s}){return e.jsx("div",{className:"flex items-center justify-center min-h-screen py-4",children:e.jsxs(W,{className:"w-full max-w-3xl shadow-lg",children:[e.jsxs(q,{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-12 h-12"}),e.jsx("h1",{className:"scroll-m-20 text-center text-lg font-extrabold tracking-tight text-balance",children:"IELTS Academic Writing"})]}),e.jsxs(k,{className:"space-y-8",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," 1 hour"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INSTRUCTIONS TO CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Answer both parts."}),e.jsx("li",{children:"You can change your answers at any time during the test."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-md font-semibold",children:"INFORMATION FOR CANDIDATES"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"There are two parts in this test."}),e.jsx("li",{children:"Part 2 contributes twice as much as Part 1 to the writing score."}),e.jsx("li",{children:"The test clock will show you when there are 10 minutes and 5 minutes remaining."})]})]}),e.jsxs("p",{className:"flex gap-2",children:[e.jsx(D,{})," Read instructions and start only when ready."]})]}),e.jsx(M,{children:e.jsx(L,{className:"w-full",onClick:s,children:"Start test"})})]})})}const se=async s=>(await N.get(`/api/writing/by-material/${s}/`)).data,ae=async(s,i)=>(await N.post(`/api/writing-answers/${s}/`,i)).data,re=y({answers:Q(y({writing:T().optional(),question_number:T().optional(),answer:z().nullable().optional()}).nullable()).optional()}),ie=s=>Z({queryKey:["writings",s],queryFn:()=>se(s),enabled:!!s}),ne=s=>{const{user:i}=_(),r=v(),n=ie(s),m=o.get(n.data,"material"),l=()=>{if(i?.role===C.TEACHER)r("/");else if(String(o.get(m,"test_type"))?.toLowerCase()=="mock"){const t=o.get(m,"next_test"),a=o.get(m,"next_test_id");r(t==="listening"&&a?`/listenings/${a}`:t==="reading"&&a?`/readings/${a}`:t==="speaking"&&a?`/speakings/${a}`:t==="writing"&&a?`/writings/${a}`:"/")}else r("/")},h=()=>{l()},p=K({mutationFn:t=>ae(s,t),onSuccess:()=>{j.success("Successfully submitted!"),h()},onError:t=>{console.error("Error:",t),j.error(o.get(t,"response.data.error",""))}}),g=Y({resolver:U(re),defaultValues:{answers:[]}}),{fields:c,replace:d}=J({control:g.control,name:"answers"});return I.useEffect(()=>{const t=n.data,a=Array.isArray(t?.writing_parts)?t.writing_parts.flatMap(u=>u?.writing_questions?.map(f=>({writing:u.id,question_number:f.question_number,answer:""}))):[];d(a)},[n.data,d]),{form:g,writingMutation:p,onSubmit:t=>{const a=[...o.get(t,"answers",[])];p.mutate(a)},answersFields:c,query:n,finish:l}},oe=()=>{const{id:s}=A(),{form:i,onSubmit:r,query:n,writingMutation:m}=ne(s),l=o.get(n,"data.writing_parts",[]),h=o.get(n,"data.answer_time",null),{timeLeft:p,formatTime:g,activeTab:c,setActiveTab:d,currentTabIndex:w,handlePrevious:t,handleNext:a,isTestFinished:u}=F(h,l,i.handleSubmit(r),!0);P(!u);const f=l.find(S=>`tab-${S.id}`===c);return n.isLoading?e.jsx(ee,{message:"Loading test data..."}):n.isError?e.jsx(b,{title:"Failed to Load Test",message:"An error occurred while loading the test. Please try again later."}):n.data?.writing_parts.length===0?e.jsx(b,{title:"Failed to load test",message:"An error occurred while loading the test questions. Please try again later."}):e.jsx(X,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-primary-foreground space-y-1",children:[e.jsx(G,{timeLeft:p,formatTime:g,testType:x.WRITING,type:o.get(n,"data.material.test_type","Mock")}),e.jsx(H,{activePart:f,testType:x.WRITING})]}),e.jsxs(O,{value:c,onValueChange:d,className:"flex flex-col flex-grow",children:[e.jsx(V,{data:l,activeTab:c,testType:x.WRITING,form:i,testId:s}),e.jsx(B,{data:l,testType:x.WRITING,form:i,activeTab:c,setActiveTab:d,currentTabIndex:w,handlePrevious:t,handleNext:a,onSubmit:i.handleSubmit(r),isTestFinished:u,isLoading:m.isPending})]})]})})},He=()=>e.jsx(R,{steps:[e.jsx(E,{}),e.jsx(te,{}),e.jsx(oe,{})]});export{He as default};
